<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Gallery — Rochelle Braganca</title>
  <meta name="description" content="High-quality photoshoots and brand shoot gallery of Rochelle Braganca." />
  <link rel="canonical" href="https://yourdomain.com/gallery.html" />
  <meta name="theme-color" content="#0d0d0f" />

  <!-- Social -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Gallery — Rochelle Braganca" />
  <meta property="og:description" content="High-quality photoshoots and brand shoot gallery." />
  <meta property="og:image" content="assets/images/og-image.jpg" />
  <meta property="og:url" content="https://yourdomain.com/gallery.html" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Icons -->
  <link rel="icon" href="assets/icons/favicon.ico" sizes="any" />
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png" />
  <link rel="manifest" href="site.webmanifest" />

  <!-- Fonts (same as index) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@500;700&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="css/main.css?v=6" />
</head>

<body>
  <header class="site-header">
    <a class="logo" href="index.html#home">Rochelle Braganca</a>
    <nav class="site-nav" aria-label="Main">
      <a href="gallery.html">Gallery</a>
      <a href="index.html#portfolio">Portfolio</a>
      <a href="index.html#music">Music</a>
      <a href="index.html#about">About</a>
      <a href="index.html#contact">Contact</a>
    </nav>
    <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </header>

  <main id="gallery">
    <!-- Page header -->
    <!-- <section class="section container">
      <div class="section-head reveal">
        <h2>Gallery</h2>
        <p>High-quality images from recent shoots. Click to view full size.</p>
      </div>
    </section> -->

    <!-- Photoshoots -->
    <section id="photoshoots" class="section container">
      <div class="section-head reveal">
        <h2>Photoshoots</h2>
        <p>Editorial and portrait selections.</p>
      </div>
      <div class="grid" id="grid-photoshoots" data-hydrated="false"></div>
    </section>

    <!-- Brand Shoots -->
    <section id="brand-shoots" class="section container">
      <div class="section-head reveal">
        <h2>Brand Shoots</h2>
        <p>Campaign and collaboration highlights.</p>
      </div>
      <div class="grid" id="grid-brand" data-hydrated="false"></div>

      <!-- Lightbox (same structure as index; required for click-to-zoom) -->
      <div class="lightbox" id="lightbox" aria-hidden="true">
        <button class="lightbox-close" aria-label="Close">×</button>
        <button class="lightbox-prev" aria-label="Previous">‹</button>
        <img id="lightbox-img" alt="" />
        <button class="lightbox-next" aria-label="Next">›</button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <small>© <span id="year"></span> Rochelle Braganca</small>
      <div class="socials">
        <a href="https://www.instagram.com/rbrz23queen" aria-label="Instagram" target="_blank"
          rel="noopener">Instagram</a>
        <a href="https://www.youtube.com/@rochellebraganca1502" aria-label="YouTube" target="_blank"
          rel="noopener">YouTube</a>
        <a href="https://open.spotify.com/artist/7jfBZISj9VYM23MXneGQoz?si=rQ1zJKN-Q0e5VV5ao_rS9A" aria-label="Spotify"
          target="_blank" rel="noopener">Spotify</a>
      </div>
    </div>
  </footer>
  <script>
    (async function () {
      try {
        // Always fetch the freshest JSON (avoid CDN/browser caches)
        const url = "/data/gallery.json?v=" + Date.now();
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) {
          console.error("Failed to fetch gallery.json", res.status, res.statusText);
          document.getElementById("grid-photoshoots")?.setAttribute("data-hydrated", "true")
          document.getElementById("grid-brand")?.setAttribute("data-hydrated", "true")
          return;
        }
        const data = await res.json();

        // Normalize to an array
        const itens = Array.isArray(data.photos) ? data.photos : Array.isArray(data) ? data : [];

        function normalizeGroup(g){
          const x = (g || "").toLowerCase().trim();
          if (x.includes("photo")) return "photoshoots";
          if (x.includes("brand")) return "brand";
          else return "brand"; // fallback so items are not lost
        }

        // Helper: ensure path has the correct subfolder based on group if missing 
        function normalizePath(path) {
          if (!path) return path;
          let s = String(path).trim();
          // Strip leading ./ or
          s = s.replace(/^\.\//, "").replace(/^\./, "");
          // Ensure leading slash 
          if (!s.startsWith("/")) s = "/" + s;
          // Collapse duplicate slashes 
          s = s.replace(/\/{2,}/g, "/");
          return s;
        }

        function ensureSubFolder(path, group) {
          let s = normalizePath(path);
          const hasSubdir = /\/assets\/gallery\/(photoshoots|brand-shoots)\//i.test(s);

          if (hasSubdir) return s;

          const file = s.split("/").pop();
          const folder = group === "photoshoots" ? "photoshoots" : "brand-shoots";
          return s = `/assets/gallery/${folder}/${file}`;
        }

        // Normalize src paths and group values
        items.forEach((p) => {
          p.group = normalizeGroup(p.group);
          p.src = ensureSubFolder(p.src, p.group);
        });

        // Sort (lowest order first)
        items.sort((a, b) => (a.order || 0) - (b.order || 0));

        const card = (p) => `
        <figure class="grid-item ratio-4-5 reveal">
          <img
            src="${p.src}"
            alt="${p.alt || ""}"
            loading="lazy"
            sizes="(max-width:560px) 100vw, (max-width:900px) 50vw, 33vw"
          />
          ${p.caption ? `<figcaption>${p.caption}</figcaption>` : ""}
        </figure>
      `;

        // Split into sections by normalized group
        const ps = items.filter((p) => p.group === "photoshoots");
        const bs = items.filter((p) => p.group === "brand");

        // Insert into the two grids
        const psGrid = document.getElementById("grid-photoshoots");
        const bsGrid = document.getElementById("grid-brand");

        // Fallback: if both empty (unexpected), show everything under Photoshoots
        if (psGrid) {
          psGrid.innerHTML = ps.map(card).join("");
          psGrid.setAttribute("data-hydrated", "true");
        }
        if (bsGrid) {
          bsGrid.innerHTML = bs.map(card).join("");
          psGrid.setAttribute("data-hydrated", "true");
        }

        // Lightbox for injected images (local to this page)
        const imgs = Array.from(document.querySelectorAll(".grid-item img"));
        const box = document.getElementById("lightbox");
        const boxImg = document.getElementById("lightbox-img");
        const prev = box?.querySelector(".lightbox-prev");
        const next = box?.querySelector(".lightbox-next");
        const closeBtn = box?.querySelector(".lightbox-close");

        let idx = 0;

        function open(i) {
          idx = i;
          const el = imgs[idx];
          boxImg.src = el.src;
          boxImg.alt = el.alt || "";
          box.classList.add("open");
          box.setAttribute("aria-hidden", "false");
        }

        function close() {
          box.classList.remove("open");
          box.setAttribute("aria-hidden", "true");
        }

        function step(d) {
          idx = (idx + d + imgs.length) % imgs.length;
          const el = imgs[idx];
          boxImg.src = el.src;
          boxImg.alt = el.alt || "";
        }

        imgs.forEach((img, i) => img.addEventListener("click", () => open(i)));
        closeBtn?.addEventListener("click", close);
        box?.addEventListener("click", (e) => { if (e.target === box) close();} );
        prev?.addEventListener("click", () => step(-1));
        next?.addEventListener("click", () => step(1));
        window.addEventListener("keydown", (e) => {
          if (!box.classList.contains("open")) return;
          if (e.key === "Escape") close();
          if (e.key === "ArrowLeft") step(-1);
          if (e.key === "ArrowRight") step(1);
        });

        // Ensure reveal items aren’t left hidden
        document.querySelectorAll(".reveal").forEach((el) => el.classList.add("in-view"));

        // Debug counts (optional): see matches in Console
        console.log("Gallery loaded:", { total: data.photos.length, photoshoots: ps.length, brand: bs.length});
      } catch (e) {
        console.error("Gallery load error", e);
        document.getElementById("grid-photoshoots")?.setAttribute("data-hydrated", "true")
        document.getElementById("grid-brand")?.setAttribute("data-hydrated", "true")
      }
    })();
  </script>
  <script src="js/main.js?v=2" defer></script>
</body>

</html>